<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta content="text/html; charset=utf-8" http-equiv="content-type"><title>Solving the 24 game - theconfused.me</title><meta content="Solving the 24 game - theconfused.me" property="title"><meta content="Solving the 24 game - theconfused.me" property="og:title"><meta property="og:description" content="The 24 game is a game I&#39;ve always liked playing. The problem is this: given four numbers, one has to try to make 24 using the four basic operations and using each number once and only once.
For example, given a list of numbers [4,8,3,6], we can get 24 by doing 4*8*(6/3) or 4*3*(8-6). What you cannot do is take, say, 4*6 and discard the rest.
Sometimes, there are also 4-number combinations that can never make 24."><meta property="og:type" content="article"><meta property="og:url" content="https://theconfused.me/blog/solving-the-24-game/"><meta property="article:published_time" content="2017-07-06T00:00:00&#43;00:00"><meta name="generator" content="Hugo 0.57.2"><style type="text/css">:root{--main-color:#4c4e4f;--secondary-color:cornflowerblue;--logo-text-color:#fff;--heading-text-color:#4c4e4f;--body-text-color:#4c4e4f;--background-color:#fdfdff}body,html{color:#303030;font-family:Helvetica,Arial,sans-serif;font-size:15px;letter-spacing:.02em}#toc,.post-content{line-height:1.5}h1,h2{font-size:1.5rem}h3,strong{font-size:1rem}h1:focus,h2:focus,h3:focus,h4:focus{outline:0}.main{max-width:650px;margin:0 auto;padding:1rem}.container{position:relative}.logo{font-size:1.5rem;font-weight:600;color:var(--secondary-color)}a{color:inherit;text-decoration:none;transition:.1s color linear,.1s border-color linear}a:hover:not(.logo){color:var(--secondary-color)}.article a{border-bottom:1px solid rgba(48,48,48,.4)}.article a:hover{border-bottom-color:var(--secondary-color)}hr{border:0;border-top:1px dashed rgba(48,48,48,.18)}.gap-top{margin-top:1.65rem}.posts-list{display:flex;margin-top:1rem}.posts-list strong{margin-left:.66rem}.date{min-width:60px;text-align:right}.faded{color:rgba(48,48,48,.4);font-style:italic;font-weight:700}pre{font-size:.9em;padding:10px 20px 10px 20px;overflow:auto;line-height:1.25em}p code{font-weight:700}.message{font-weight:400}@media only screen and (min-width:875px){.main{padding:3rem 1rem;padding:bottom: 5rem}}figure{margin:2em 1em}img{display:block;margin-left:auto;margin-right:auto;box-shadow:1px 1px 2px 2px #bbb;max-width:100%}figure.no-border img{box-shadow:none}figure.img-wide img{margin-left:-100px;margin-right:-100px;max-width:850px}@media (max-width:850px){figure.img-wide img{margin-left:0;margin-right:0;max-width:100%}}figcaption{text-align:center;margin-top:.5em;color:gray}blockquote{border-left-style:solid;border-left-width:1px;border-color:rgba(48,48,48,.18);border-width:.25rem;margin-left:0;margin-top:0;margin-right:0;padding-left:1rem}blockquote p{color:#666;margin-top:0;font-style:italic}blockquote p>cite{text-transform:uppercase;font-style:normal;letter-spacing:.1em;font-size:.875rem;display:block}table{font-size:14px;border-collapse:collapse;margin:2rem auto;padding:0}table tr{border-top:1px solid #ccc;margin:0;padding:0}table tr td[align=center],table tr th[align=center]{text-align:center}table tr td,table tr th{border:1px solid #ccc;text-align:left;margin:0;padding:6px 13px}#toc{position:fixed}#toc>.toc-list{max-width:250px;overflow:hidden;position:fixed;right:2rem}@media (min-width:1200px){#toc>.toc-list{display:block;top:100px}}@media (min-width:1330px){#toc>.toc-list{max-width:300px;right:3rem}}#toc ol{list-style:none}.gray{color:rgba(48,48,48,.4);font-weight:700}</style><link rel="icon" href="https://theconfused.me/favicon.ico" type="image/x-icon"><link href="https://theconfused.me/feed.xml" rel="alternate" type="application/atom+xml" title="theconfused.me"><script type="application/javascript">var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-96137027-1","auto"),ga("send","pageview"))</script><script async src="https://www.google-analytics.com/analytics.js"></script></head><body><div class="main"><div class="container" class="article gap-top-container"><div style="margin-bottom:1.5rem"><a class="logo" href="https://theconfused.me/">theconfused.me</a></div><span class="gray">06 Jul 2017 { <a href="https://theconfused.me/tags/python">python</a> }</span><h1>Solving the 24 game</h1><div class="post-content article"><p>The <a href="https://en.wikipedia.org/wiki/24_Game" target="_blank">24 game</a> is a game I've always liked playing. The problem is this: given four numbers, one has to try to make 24 using the four basic operations and using each number once and only once.</p><p>For example, given a list of numbers <code>[4,8,3,6]</code>, we can get 24 by doing <code>4*8*(6/3)</code> or <code>4*3*(8-6)</code>. What you cannot do is take, say, <code>4*6</code> and discard the rest.</p><p>Sometimes, there are also 4-number combinations that can never make 24. One example is <code>[3,9,4,10]</code>. What usually happens in a game when we encounter such combinations is that we would stare at the cards in silence for a long period of time, before at some point we both agree that this is an impossible combination. But this is incredibly arbitrary; we might very well pass over combinations that are actually possible but neither of us could see.</p><p>One very commonly missed one was <code>[1,5,5,5]</code>. You can have a try if you want to play along, but don't spend too long.</p><p>So I wanted to write a program to check if there is a solution to a given a set of numbers, and print the solution if it exists. I've tried this a few years back when I first started coding, but somehow just couldn't cover all the edge cases. Armed with slightly more programming knowledge and experience, I decided to give it another go.</p><h2 id="the-instinctive-approach">The instinctive approach</h2><p>My first instinct was to construct all possible expressions that are possible with the four numbers and check whether any of them equal 24, or any other number you choose. It is easy to permute the numbers and operations, but the main difficulty lies in the placement of brackets.</p><p>For four numbers, the possible positions of brackets are still iterable, though just barely, and makes the code look very ugly. For example, there is a <a href="https://rosettacode.org/wiki/24_game/Solve#Python" target="_blank">solution</a> on Rosetta Code that uses this principle; it specifies all the possible bracket insertion indices in an arithmetic expression string using the following code snippet:</p><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">brackets</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000;font-weight:700">(</span> <span style="color:#000;font-weight:700">[()]</span> <span style="color:#ce5c00;font-weight:700">+</span> <span style="color:#000;font-weight:700">[(</span><span style="color:#000">x</span><span style="color:#000;font-weight:700">,</span><span style="color:#000">y</span><span style="color:#000;font-weight:700">)</span>
                     <span style="color:#204a87;font-weight:700">for</span> <span style="color:#000">x</span> <span style="color:#204a87;font-weight:700">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:700">(</span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">exprlen</span><span style="color:#000;font-weight:700">,</span> <span style="color:#0000cf;font-weight:700">2</span><span style="color:#000;font-weight:700">)</span>
                     <span style="color:#204a87;font-weight:700">for</span> <span style="color:#000">y</span> <span style="color:#204a87;font-weight:700">in</span> <span style="color:#204a87">range</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:700">+</span><span style="color:#0000cf;font-weight:700">4</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">exprlen</span><span style="color:#ce5c00;font-weight:700">+</span><span style="color:#0000cf;font-weight:700">2</span><span style="color:#000;font-weight:700">,</span> <span style="color:#0000cf;font-weight:700">2</span><span style="color:#000;font-weight:700">)</span>
                     <span style="color:#204a87;font-weight:700">if</span> <span style="color:#000;font-weight:700">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:700">,</span><span style="color:#000">y</span><span style="color:#000;font-weight:700">)</span> <span style="color:#ce5c00;font-weight:700">!=</span> <span style="color:#000;font-weight:700">(</span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">,</span><span style="color:#000">exprlen</span><span style="color:#ce5c00;font-weight:700">+</span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">)]</span>
             <span style="color:#ce5c00;font-weight:700">+</span> <span style="color:#000;font-weight:700">[(</span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">,</span> <span style="color:#0000cf;font-weight:700">3</span><span style="color:#ce5c00;font-weight:700">+</span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">,</span> <span style="color:#0000cf;font-weight:700">4</span><span style="color:#ce5c00;font-weight:700">+</span><span style="color:#0000cf;font-weight:700">2</span><span style="color:#000;font-weight:700">,</span> <span style="color:#0000cf;font-weight:700">7</span><span style="color:#ce5c00;font-weight:700">+</span><span style="color:#0000cf;font-weight:700">3</span><span style="color:#000;font-weight:700">)]</span> <span style="color:#000;font-weight:700">)</span> <span style="color:#8f5902;font-style:italic"># double brackets case</span></code></pre></div><p>The empty tuple is the case with no brackets, the list comprehension after that generates all possible combinations of open brackets (variable <code>x</code>) and close brackets (variable <code>y</code>), and the third list is the indices of the brackets in the double bracket case, as in <code>(5 + 3) * (1 + 2)</code>.</p><p>The major limitation of this solution is that it only works for four numbers, where it is easy to reason about the bracket placements. To make it work for more than 4 numbers, one would have to take into account double and triple brackets, nested brackets, and many more. In retrospect it might be possible to algorithmically generate possible bracket placements, possibly with some kind of recursive algorithm, but at that point it just felt paralyzingly messy.</p><h2 id="a-recursive-approach">A recursive approach</h2><p>I realized that to make it work for more numbers than four, I would have to take a different approach. I am pretty good at the game, so I thought about the strategy I use when playing the game and realized my first approach was wholly mechanical and unnatural.</p><p>I don't think about bracket placement when I play the game, neither do I try to construct all possible expressions from the four numbers and evaluate them one-by-one to see if they give the desired answer. Instead, given four numbers, what I would do mentally is this: I would try to combine pairs of numbers and reduce them, until there are two numbers remaining, and then check if there is any way these two numbers evaluate to 24.</p><p>For example, if we started with <code>[1,2,3,4]</code>, this is roughly the thought process that occurs:</p><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">[1,2,3,4] --&gt; [1,6,4] --&gt; [1,24] --&gt; 24 --&gt; success!</pre></div><p>As such, it becomes apparent that this is a recursive solution: solving for n numbers is the same as choosing to combine 2 numbers and solving for the remaining n-1 numbers.</p><p>Once I got this realization, writing the algorithm was not difficult. For a given list of numbers, I iterate through all possible pairs that can be generated from the list. For each pair, I go through the possible values that can be produced from the pair by using the 4 operators. For each value, I generate a list with one less element than the previous, and call the function again.</p><p>This contains two nested for loops, and might blow up for a large input array. But practically the 24 game is usually played with 4 numbers, and the algorithm does reasonably well with a list of similar order of magnitude.</p><p>The resulting python code looks like this, with the main solver logic in <code>solve()</code>:</p><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#204a87;font-weight:700">import</span> <span style="color:#000">itertools</span>

<span style="color:#204a87;font-weight:700">def</span> <span style="color:#000">solve</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">numbers</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">goal</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#0000cf;font-weight:700">24</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">expr</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#000;font-weight:700">[]):</span>
    <span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">expr</span> <span style="color:#ce5c00;font-weight:700">==</span> <span style="color:#000;font-weight:700">[]:</span>
        <span style="color:#000">expr</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000;font-weight:700">[</span><span style="color:#204a87">str</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">n</span><span style="color:#000;font-weight:700">)</span> <span style="color:#204a87;font-weight:700">for</span> <span style="color:#000">n</span> <span style="color:#204a87;font-weight:700">in</span> <span style="color:#000">numbers</span><span style="color:#000;font-weight:700">]</span>
    <span style="color:#204a87;font-weight:700">if</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">numbers</span><span style="color:#000;font-weight:700">)</span> <span style="color:#ce5c00;font-weight:700">==</span> <span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">:</span>
        <span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">numbers</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">]</span> <span style="color:#ce5c00;font-weight:700">==</span> <span style="color:#000">goal</span><span style="color:#000;font-weight:700">:</span>
            <span style="color:#204a87;font-weight:700">return</span> <span style="color:#000">numbers</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">]</span>
        <span style="color:#204a87;font-weight:700">else</span><span style="color:#000;font-weight:700">:</span>
            <span style="color:#204a87;font-weight:700">return</span> <span style="color:#3465a4">False</span>
    <span style="color:#204a87;font-weight:700">if</span> <span style="color:#204a87">len</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">numbers</span><span style="color:#000;font-weight:700">)</span> <span style="color:#ce5c00;font-weight:700">==</span> <span style="color:#0000cf;font-weight:700">2</span><span style="color:#000;font-weight:700">:</span>
        <span style="color:#000">answers</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">answer_exps</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000">combinetwo</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">numbers</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">],</span> <span style="color:#000">numbers</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">])</span>
        <span style="color:#204a87;font-weight:700">for</span> <span style="color:#000">i</span><span style="color:#000;font-weight:700">,</span><span style="color:#000">answer</span> <span style="color:#204a87;font-weight:700">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">answers</span><span style="color:#000;font-weight:700">):</span>
            <span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">answer</span> <span style="color:#ce5c00;font-weight:700">==</span> <span style="color:#000">goal</span><span style="color:#000;font-weight:700">:</span>
                <span style="color:#204a87;font-weight:700">return</span> <span style="color:#000">convert_expr_to_string</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">expr</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">],</span> <span style="color:#000">expr</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">],</span> <span style="color:#000">answer_exps</span><span style="color:#000;font-weight:700">[</span><span style="color:#000">i</span><span style="color:#000;font-weight:700">])</span>
        <span style="color:#204a87;font-weight:700">return</span> <span style="color:#3465a4">False</span>

    <span style="color:#000">pairs</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#204a87">set</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">itertools</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">combinations</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">numbers</span><span style="color:#000;font-weight:700">,</span> <span style="color:#0000cf;font-weight:700">2</span><span style="color:#000;font-weight:700">))</span>
    <span style="color:#204a87;font-weight:700">for</span> <span style="color:#000">pair</span> <span style="color:#204a87;font-weight:700">in</span> <span style="color:#000">pairs</span><span style="color:#000;font-weight:700">:</span>
        <span style="color:#000">possible_values</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">possible_expr</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000">combinetwo</span><span style="color:#000;font-weight:700">(</span><span style="color:#ce5c00;font-weight:700">*</span><span style="color:#000">pair</span><span style="color:#000;font-weight:700">)</span>
        <span style="color:#204a87;font-weight:700">for</span> <span style="color:#000">counter</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">value</span> <span style="color:#204a87;font-weight:700">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">possible_values</span><span style="color:#000;font-weight:700">):</span>
            <span style="color:#000">expression</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000">possible_expr</span><span style="color:#000;font-weight:700">[</span><span style="color:#000">counter</span><span style="color:#000;font-weight:700">]</span>
            <span style="color:#000">a_index</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000">numbers</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">index</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">pair</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">])</span>
            <span style="color:#000">b_index</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000">numbers</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">index</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">pair</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">])</span>
            <span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">a_index</span> <span style="color:#ce5c00;font-weight:700">==</span> <span style="color:#000">b_index</span><span style="color:#000;font-weight:700">:</span>
                <span style="color:#000">b_index</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000">numbers</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">index</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">pair</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">],</span> <span style="color:#000">a_index</span> <span style="color:#ce5c00;font-weight:700">+</span> <span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">);</span>

            <span style="color:#000">expr_string</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000">convert_expr_to_string</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">expr</span><span style="color:#000;font-weight:700">[</span><span style="color:#000">a_index</span><span style="color:#000;font-weight:700">],</span> <span style="color:#000">expr</span><span style="color:#000;font-weight:700">[</span><span style="color:#000">b_index</span><span style="color:#000;font-weight:700">],</span> <span style="color:#000">expression</span><span style="color:#000;font-weight:700">)</span>
            <span style="color:#000">newlist</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000">numbers</span><span style="color:#000;font-weight:700">[:]</span>
            <span style="color:#000">newexpr</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000">expr</span><span style="color:#000;font-weight:700">[:]</span>
            
            <span style="color:#8f5902;font-style:italic"># replace the two numbers with the combined result</span>
            <span style="color:#000">a_index</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000">newlist</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">index</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">pair</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">])</span>
            <span style="color:#000">newlist</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">pop</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">a_index</span><span style="color:#000;font-weight:700">)</span>
            <span style="color:#000">b_index</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000">newlist</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">index</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">pair</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">])</span>
            <span style="color:#000">newlist</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">pop</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">b_index</span><span style="color:#000;font-weight:700">)</span>
            <span style="color:#000">newlist</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">value</span><span style="color:#000;font-weight:700">)</span>

            <span style="color:#8f5902;font-style:italic"># order matters</span>
            <span style="color:#000">newexpr</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">pop</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">a_index</span><span style="color:#000;font-weight:700">)</span>
            <span style="color:#000">newexpr</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">pop</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">b_index</span><span style="color:#000;font-weight:700">)</span>
            <span style="color:#000">newexpr</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">expr_string</span><span style="color:#000;font-weight:700">)</span>
            <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000">solve</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">newlist</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">goal</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">newexpr</span><span style="color:#000;font-weight:700">)</span>
            <span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">result</span><span style="color:#000;font-weight:700">:</span>
                <span style="color:#204a87;font-weight:700">return</span> <span style="color:#000">remove_redundant_brackets</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">result</span><span style="color:#000;font-weight:700">)</span>
            <span style="color:#204a87;font-weight:700">else</span><span style="color:#000;font-weight:700">:</span>
                <span style="color:#204a87;font-weight:700">continue</span>

<span style="color:#204a87;font-weight:700">def</span> <span style="color:#000">convert_expr_to_string</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">expr</span><span style="color:#000;font-weight:700">):</span>
    <span style="color:#000">temp</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000;font-weight:700">[</span><span style="color:#000">a</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:700">]</span>
    <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#4e9a06">&#39;(&#39;</span> <span style="color:#ce5c00;font-weight:700">+</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">temp</span><span style="color:#000;font-weight:700">[</span><span style="color:#000">expr</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">]])</span> <span style="color:#ce5c00;font-weight:700">+</span> <span style="color:#4e9a06">&#39;)&#39;</span> <span style="color:#ce5c00;font-weight:700">+</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">expr</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">])</span> <span style="color:#ce5c00;font-weight:700">+</span> <span style="color:#4e9a06">&#39;(&#39;</span> <span style="color:#ce5c00;font-weight:700">+</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">temp</span><span style="color:#000;font-weight:700">[</span><span style="color:#000">expr</span><span style="color:#000;font-weight:700">[</span><span style="color:#0000cf;font-weight:700">2</span><span style="color:#000;font-weight:700">]])</span> <span style="color:#ce5c00;font-weight:700">+</span> <span style="color:#4e9a06">&#39;)&#39;</span>
    <span style="color:#204a87;font-weight:700">return</span> <span style="color:#000">result</span>

<span style="color:#204a87;font-weight:700">def</span> <span style="color:#000">combinetwo</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">b</span><span style="color:#000;font-weight:700">):</span>
    <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000;font-weight:700">[</span><span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:700">+</span> <span style="color:#000">b</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:700">*</span> <span style="color:#000">b</span><span style="color:#000;font-weight:700">]</span>
    <span style="color:#000">expr</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000;font-weight:700">[(</span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">,</span> <span style="color:#4e9a06">&#39;+&#39;</span><span style="color:#000;font-weight:700">,</span> <span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">),</span> <span style="color:#000;font-weight:700">(</span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">,</span> <span style="color:#4e9a06">&#39;*&#39;</span><span style="color:#000;font-weight:700">,</span> <span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">)]</span>
    <span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:700">&gt;</span> <span style="color:#000">a</span><span style="color:#000;font-weight:700">:</span>
        <span style="color:#000">result</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">b</span><span style="color:#ce5c00;font-weight:700">-</span><span style="color:#000">a</span><span style="color:#000;font-weight:700">)</span>
        <span style="color:#000">expr</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:700">((</span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">,</span> <span style="color:#4e9a06">&#39;-&#39;</span><span style="color:#000;font-weight:700">,</span> <span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">))</span>
    <span style="color:#204a87;font-weight:700">else</span><span style="color:#000;font-weight:700">:</span>
        <span style="color:#000">result</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">a</span><span style="color:#ce5c00;font-weight:700">-</span><span style="color:#000">b</span><span style="color:#000;font-weight:700">)</span>
        <span style="color:#000">expr</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:700">((</span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">,</span> <span style="color:#4e9a06">&#39;-&#39;</span><span style="color:#000;font-weight:700">,</span> <span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">))</span>
    <span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:700">!=</span> <span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">:</span>
        <span style="color:#000">result</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:700">/</span> <span style="color:#000">b</span><span style="color:#000;font-weight:700">)</span>
        <span style="color:#000">expr</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:700">((</span><span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">,</span> <span style="color:#4e9a06">&#39;/&#39;</span><span style="color:#000;font-weight:700">,</span> <span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">))</span>
    <span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:700">!=</span> <span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">:</span>
        <span style="color:#000">result</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:700">/</span> <span style="color:#000">a</span><span style="color:#000;font-weight:700">)</span>
        <span style="color:#000">expr</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:700">((</span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">,</span> <span style="color:#4e9a06">&#39;/&#39;</span><span style="color:#000;font-weight:700">,</span> <span style="color:#0000cf;font-weight:700">0</span><span style="color:#000;font-weight:700">))</span>
    <span style="color:#204a87;font-weight:700">return</span> <span style="color:#000">result</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">expr</span>

<span style="color:#204a87;font-weight:700">def</span> <span style="color:#000">remove_redundant_brackets</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">expr</span><span style="color:#000;font-weight:700">):</span>
    <span style="color:#000">stack</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000;font-weight:700">[]</span>
    <span style="color:#8f5902;font-style:italic"># indices to be deleted</span>
    <span style="color:#000">indices</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000;font-weight:700">[]</span>
    <span style="color:#204a87;font-weight:700">for</span> <span style="color:#000">i</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">ch</span> <span style="color:#204a87;font-weight:700">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">expr</span><span style="color:#000;font-weight:700">):</span>
        <span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">ch</span> <span style="color:#ce5c00;font-weight:700">==</span> <span style="color:#4e9a06">&#39;(&#39;</span><span style="color:#000;font-weight:700">:</span>
            <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">i</span><span style="color:#000;font-weight:700">)</span>
        <span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">ch</span> <span style="color:#ce5c00;font-weight:700">==</span> <span style="color:#4e9a06">&#39;)&#39;</span><span style="color:#000;font-weight:700">:</span>
            <span style="color:#000">last_bracket_index</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000">stack</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">pop</span><span style="color:#000;font-weight:700">()</span>
            <span style="color:#000">enclosed</span> <span style="color:#ce5c00;font-weight:700">=</span> <span style="color:#000">expr</span><span style="color:#000;font-weight:700">[</span><span style="color:#000">last_bracket_index</span> <span style="color:#ce5c00;font-weight:700">+</span> <span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">:</span><span style="color:#000">i</span><span style="color:#000;font-weight:700">]</span>
            <span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">enclosed</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">isdigit</span><span style="color:#000;font-weight:700">():</span>
                <span style="color:#000">indices</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">i</span><span style="color:#000;font-weight:700">)</span>
                <span style="color:#000">indices</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">append</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">last_bracket_index</span><span style="color:#000;font-weight:700">)</span>
    <span style="color:#204a87;font-weight:700">return</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#ce5c00;font-weight:700">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:700">([</span><span style="color:#000">char</span> <span style="color:#204a87;font-weight:700">for</span> <span style="color:#000">idx</span><span style="color:#000;font-weight:700">,</span> <span style="color:#000">char</span> <span style="color:#204a87;font-weight:700">in</span> <span style="color:#204a87">enumerate</span><span style="color:#000;font-weight:700">(</span><span style="color:#000">expr</span><span style="color:#000;font-weight:700">)</span> <span style="color:#204a87;font-weight:700">if</span> <span style="color:#000">idx</span> <span style="color:#204a87;font-weight:700">not</span> <span style="color:#204a87;font-weight:700">in</span> <span style="color:#000">indices</span><span style="color:#000;font-weight:700">])</span></code></pre></div><p>An example usage looks like this:</p><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ce5c00;font-weight:700">&gt;&gt;&gt;</span> <span style="color:#000">solve</span><span style="color:#000;font-weight:700">([</span><span style="color:#0000cf;font-weight:700">1</span><span style="color:#000;font-weight:700">,</span> <span style="color:#0000cf;font-weight:700">5</span><span style="color:#000;font-weight:700">,</span> <span style="color:#0000cf;font-weight:700">5</span><span style="color:#000;font-weight:700">,</span> <span style="color:#0000cf;font-weight:700">5</span><span style="color:#000;font-weight:700">],</span> <span style="color:#000">goal</span><span style="color:#ce5c00;font-weight:700">=</span><span style="color:#0000cf;font-weight:700">24</span><span style="color:#000;font-weight:700">)</span>
<span style="color:#4e9a06">&#39;5*(5-(1/5))&#39;</span></code></pre></div><p>Of course you can pass in any goal and a list of arbitrary length. Currently, it should return nothing if there is no solution.</p><p>I also converted the python code above to javascript, and made a <a href="https://theconfused.me/get24" target="_blank">page</a> so that people can play around with the game.</p></div><hr class="gap-top"><div class="faded gap-top message">You can email me at lingyihuu(at)gmail.com if you have any comments, suggestions, or questions. I should respond promptly, because frankly I am not famous enough to be ignoring emails yet.</div><div class="faded gap-top"><a href="https://theconfused.me/" style="margin-right:2rem">&larr; home</a> <a href="https://theconfused.me/blog">&larr; blog archive</a></div></div></div></body></html>